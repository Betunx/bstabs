<header class="bg-bs-carbon text-white sticky top-0 z-50 shadow-lg">
  <div class="container mx-auto px-4 py-4 flex items-center justify-between">
    <!-- Logo BS -->
    <a routerLink="/" class="flex items-center space-x-3">
      <div class="text-3xl font-bold font-sans">BS</div>
      <span class="text-sm hidden md:block">Black Sheep</span>
    </a>

    <!-- Navigation -->
    <nav class="hidden md:flex space-x-6">
      <a routerLink="/artists" routerLinkActive="text-bs-gold" class="hover:text-bs-gold transition">Artistas</a>
      <a routerLink="/songs" routerLinkActive="text-bs-gold" class="hover:text-bs-gold transition">Canciones</a>
      <a routerLink="/tutorials" routerLinkActive="text-bs-gold" class="hover:text-bs-gold transition">Tutoriales</a>
      <a routerLink="/request-song" routerLinkActive="text-bs-gold" class="hover:text-bs-gold transition">Pedir Canción</a>
      <a routerLink="/contact" routerLinkActive="text-bs-gold" class="hover:text-bs-gold transition">Contacto</a>

      <!-- Admin link - only visible in dev/preview -->
      @if (isDevMode()) {
        <a routerLink="/admin" routerLinkActive="text-bs-gold" class="hover:text-bs-gold transition bg-red-600 px-3 py-1 rounded">
          Admin
        </a>
      }
    </nav>

    <!-- Search, Theme Selector & Donate Button -->
    <div class="flex items-center space-x-4">
      <!-- Search Button -->
      <button
        (click)="toggleSearch()"
        class="text-white hover:text-bs-gold transition"
        title="Buscar">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
      </button>

      <!-- Theme Switcher Dropdown -->
      <div class="relative">
        <!-- Botón actual del tema -->
        <button
          (click)="toggleThemeDropdown()"
          (mouseenter)="isThemeDropdownOpen.set(true)"
          class="w-10 h-10 rounded-full border-2 border-white hover:scale-110 transition-all duration-200 shadow-lg flex items-center justify-center"
          [style.background-color]="themeService.themes[themeService.currentTheme()].preview"
          [title]="themeService.themes[themeService.currentTheme()].name">
          <span class="text-xs font-bold"
                [style.color]="themeService.themes[themeService.currentTheme()].textColor">
            {{ themeService.themes[themeService.currentTheme()].name.charAt(0) }}
          </span>
        </button>

        <!-- Dropdown de temas -->
        @if (isThemeDropdownOpen()) {
          <div
            (mouseleave)="closeThemeDropdown()"
            class="absolute top-12 right-0 bg-gray-800 rounded-lg shadow-xl p-2 space-y-2 min-w-[160px] z-50 animate-fadeIn">
            @for (themeKey of getThemeKeys(); track themeKey) {
              <button
                (click)="setTheme(themeKey)"
                [class.ring-2]="themeService.currentTheme() === themeKey"
                [class.ring-bs-gold]="themeService.currentTheme() === themeKey"
                class="w-full flex items-center space-x-3 px-3 py-2 rounded hover:bg-gray-700 transition">
                <div
                  class="w-6 h-6 rounded-full border-2 border-white"
                  [style.background-color]="themeService.themes[themeKey].preview">
                </div>
                <span class="text-white text-sm">{{ themeService.themes[themeKey].name }}</span>
              </button>
            }
          </div>
        }
      </div>

      <!-- Donate Button -->
      <a
        routerLink="/donate"
        class="bg-bs-gold hover:bg-yellow-600 text-black font-bold w-12 h-12 rounded-full flex items-center justify-center shadow-lg hover:scale-110 transition">
        D
      </a>
    </div>
  </div>

  <!-- Mobile Navigation -->
  <nav class="md:hidden flex justify-around py-2 border-t border-gray-700">
    <a routerLink="/artists" routerLinkActive="text-bs-gold" class="text-xs hover:text-bs-gold">Artistas</a>
    <a routerLink="/songs" routerLinkActive="text-bs-gold" class="text-xs hover:text-bs-gold">Canciones</a>
    <a routerLink="/tutorials" routerLinkActive="text-bs-gold" class="text-xs hover:text-bs-gold">Tutoriales</a>
    <a routerLink="/request-song" routerLinkActive="text-bs-gold" class="text-xs hover:text-bs-gold">Pedir</a>
    <a routerLink="/contact" routerLinkActive="text-bs-gold" class="text-xs hover:text-bs-gold">Contacto</a>
  </nav>
</header>

<!-- Search Modal -->
@if (isSearchOpen()) {
  <div class="fixed inset-0 bg-black bg-opacity-50 z-[100] animate-fadeIn" (click)="closeSearch()">
    <div class="container mx-auto px-4 py-8" (click)="$event.stopPropagation()">
      <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-2xl overflow-hidden">
        <!-- Search Input -->
        <div class="p-4 border-b border-gray-200">
          <div class="relative">
            <input
              type="text"
              [(ngModel)]="searchQuery"
              (input)="onSearchInput($event)"
              placeholder="Buscar canciones, artistas, letras..."
              class="w-full px-4 py-3 pl-12 text-lg border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
              autofocus>
            <svg class="w-6 h-6 absolute left-3 top-3.5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </div>
        </div>

        <!-- Did You Mean? -->
        @if (didYouMean()) {
          <div class="p-4 bg-yellow-50 border-b border-yellow-200">
            <p class="text-sm text-gray-700">
              ¿Quisiste decir:
              <button
                (click)="applyDidYouMean(didYouMean()!)"
                class="text-blue-600 hover:underline font-semibold ml-1">
                {{ didYouMean() }}
              </button>
              ?
            </p>
          </div>
        }

        <!-- Search Results -->
        <div class="max-h-96 overflow-y-auto">
          @if (searchResults().length > 0) {
            @for (result of searchResults(); track result.url) {
              <button
                (click)="selectResult(result)"
                class="w-full p-4 hover:bg-gray-50 border-b border-gray-100 text-left transition">
                <div class="flex items-start space-x-3">
                  <!-- Icon based on type -->
                  @if (result.type === 'artist') {
                    <svg class="w-5 h-5 text-blue-500 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                  } @else if (result.type === 'song') {
                    <svg class="w-5 h-5 text-green-500 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path>
                    </svg>
                  } @else {
                    <svg class="w-5 h-5 text-purple-500 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path>
                    </svg>
                  }

                  <!-- Result Content -->
                  <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-gray-900 truncate">
                      {{ result.match }}
                    </p>
                    @if (result.type === 'lyric' && result.artist) {
                      <p class="text-xs text-gray-500 mt-1">
                        {{ result.artist }}
                      </p>
                    }
                  </div>

                  <!-- Type Badge -->
                  <span class="text-xs px-2 py-1 rounded-full" [ngClass]="{
                    'bg-blue-100 text-blue-700': result.type === 'artist',
                    'bg-green-100 text-green-700': result.type === 'song',
                    'bg-purple-100 text-purple-700': result.type === 'lyric'
                  }">
                    {{ result.type === 'artist' ? 'Artista' : result.type === 'song' ? 'Canción' : 'Letra' }}
                  </span>
                </div>
              </button>
            }
          } @else if (searchQuery().length >= 2) {
            <div class="p-8 text-center text-gray-500">
              <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <p>No se encontraron resultados</p>
            </div>
          } @else {
            <div class="p-8 text-center text-gray-400">
              <svg class="w-16 h-16 mx-auto mb-4 text-gray-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
              </svg>
              <p>Escribe al menos 2 caracteres para buscar</p>
            </div>
          }
        </div>

        <!-- Footer -->
        <div class="p-3 bg-gray-50 border-t border-gray-200 text-xs text-gray-500 text-center">
          Busca por canción, artista o fragmento de letra
        </div>
      </div>
    </div>
  </div>
}
