<div class="songs-page">
  <!-- Controles de filtros -->
  <div class="filters-container">
    <div class="container mx-auto px-4 py-4">
      <div class="flex flex-wrap items-center gap-4 justify-between">
        <!-- Búsqueda en tiempo real con autocomplete -->
        <div class="flex-1 max-w-md relative">
          <input
            type="text"
            [ngModel]="searchQuery()"
            (ngModelChange)="setSearchQuery($event)"
            (focus)="onSearchFocus()"
            (blur)="hideSuggestions()"
            placeholder="Buscar por canción o artista..."
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-bs-gold focus:border-transparent"
            autocomplete="off">

          <!-- Autocomplete dropdown -->
          @if (showSuggestions() && suggestions().length > 0) {
            <div class="absolute z-10 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg shadow-lg max-h-64 overflow-y-auto">
              @for (suggestion of suggestions(); track suggestion.id) {
                <button
                  type="button"
                  (click)="selectSuggestion(suggestion)"
                  class="w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition border-b border-gray-200 dark:border-gray-700 last:border-b-0">
                  <div class="font-semibold" [innerHTML]="highlightMatch(suggestion.title, searchQuery())"></div>
                  <div class="text-sm text-gray-600 dark:text-gray-400" [innerHTML]="highlightMatch(suggestion.artist, searchQuery())"></div>
                </button>
              }
            </div>
          }
        </div>

        <!-- Filtro por género -->
        <div class="flex items-center gap-2">
          <label class="text-sm font-semibold">Género:</label>
          <select
            [ngModel]="selectedGenre()"
            (ngModelChange)="setGenre($event)"
            class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-bs-gold">
            <option value="">Todos</option>
            @for (genre of genres; track genre) {
              <option [value]="genre">{{ genre }}</option>
            }
          </select>
        </div>

        <!-- Ordenamiento -->
        <div class="flex items-center gap-2">
          <label class="text-sm font-semibold">Ordenar:</label>
          <select
            [(ngModel)]="sortBy"
            (ngModelChange)="setSortBy($event)"
            class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-bs-gold">
            <option value="recent">Más recientes</option>
            <option value="a-z">A-Z</option>
          </select>
        </div>
      </div>

      <!-- Contador de resultados -->
      @if (searchQuery()) {
        <div class="mt-3 text-sm text-gray-600">
          {{ songs().length }} resultado{{ songs().length !== 1 ? 's' : '' }} encontrado{{ songs().length !== 1 ? 's' : '' }}
        </div>
      }
    </div>
  </div>

  <!-- Lista de canciones (componente compacto) -->
  @if (loading()) {
    <div class="container mx-auto px-4 py-8">
      <app-skeleton-song-list [count]="10"></app-skeleton-song-list>
    </div>
  } @else {
    <app-song-list-compact
      [songs]="songs()"
      emptyMessage="No hay canciones disponibles">
    </app-song-list-compact>
  }

  <!-- CTA para pedir canciones (si lista vacía por búsqueda) -->
  @if (songs().length === 0 && searchQuery()) {
    <div class="empty-state">
      <div class="container mx-auto px-4 py-8 text-center">
        <p class="text-gray-600 mb-4">¿No encuentras lo que buscas?</p>
        <a routerLink="/request-song" class="btn-primary inline-block px-6 py-3 bg-bs-gold text-black font-semibold rounded-lg hover:bg-yellow-500 transition">
          Solicitar una canción
        </a>
      </div>
    </div>
  }
</div>
